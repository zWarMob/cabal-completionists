const { REST } = require('@discordjs/rest');
const { Routes } = require('discord-api-types/v9');
// const { token } = require('./config.json');
const path = require('path');
const fs = require('fs');
const {items} = require("app/items");

// Place your client and guild ids here
const clientId = '878992745514008576';
const guildId = '801501061448990740';
const clientCreds = [
    {
        clientId: "878992745514008576",
        guildId: "801501061448990740",
        token: "ODc4OTkyNzQ1NTE0MDA4NTc2.YSJPyQ.DKA5h0r0Dz_oJa59f3gtBW493yU"
    },
    {
        clientId: "880421810154389565",
        guildId: "801501061448990740",
        token: "ODgwNDIxODEwMTU0Mzg5NTY1.YSeCtA.6Gv59V0PC0hU_ogfx_YHtuxh2Ik"
    }
]

// const {discordAppToken} = require('../../../config.json');
const e = require('express');

module.exports = (clients) => {
    clients.handleItemCommands = async(commandFolders, fpath) => {
        var i=0;
        iClient = 0;
        for(client of clients){
            var commandItems = items.slice(i,i+25);
            console.log(i)
            console.log("ðŸ”¥", clientCreds[iClient]);
            console.log("ðŸ”¥", commandItems[0], commandItems[1]);
            client.commandArray = [];
            for (folder of commandFolders) {
                const commandFiles = fs.readdirSync(`./node_modules/${fpath}/${folder}`).filter(file => file.endsWith(".js"));
                for (const file of commandFiles){
                    const command = require(`${fpath}/${folder}/${file}`)(commandItems);
                    console.log(command);
                    client.commands.set(command.data.name, command);
                    client.commandArray.push(command.data.toJSON());
                }
            }
            
            const rest = new REST({ version: '9' }).setToken(clientCreds[iClient].token);
            
            (async () => {
                try {
                    console.log('Started refreshing application (/) commands.');
                    
                    await rest.put(
                        Routes.applicationGuildCommands(clientCreds[iClient].clientId, clientCreds[iClient].guildId),
                        { body: client.commandArray },
                    );
                    
                    console.log('Successfully reloaded application (/) commands.');
                } catch (error) {
                    console.error(error);
                }
            })();
            
            i+=25;
            iClient += 1;
        }
    }
}